apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: mini-llm-alerts
  labels:
    app: mini-llm
    prometheus: kube-prometheus-stack
    role: alert-rules
spec:
  groups:
  - name: mini-llm
    interval: 30s
    rules:
    - alert: MiniLLMHighCPU
      expr: llm_cpu_usage_percent > 80
      for: 5m
      labels:
        severity: warning
        component: mini-llm
      annotations:
        summary: "Mini LLM CPU usage is high"
        description: "CPU usage has been above 80% for 5 minutes (current: {{ $value }}%)"

    - alert: MiniLLMMany503Errors
      expr: sum(rate(llm_requests_total{status="503"}[5m])) > 5
      for: 2m
      labels:
        severity: warning
        component: mini-llm
      annotations:
        summary: "Mini LLM is returning many 503 errors"
        description: "More than 5 requests per minute are failing with 503 errors"

    - alert: MiniLLMModelNotLoaded
      expr: llm_model_loaded == 0
      for: 1m
      labels:
        severity: critical
        component: mini-llm
      annotations:
        summary: "Mini LLM model failed to load"
        description: "The LLM model is not loaded - inference will fail"

    - alert: MiniLLMHighMemory
      expr: llm_memory_usage_bytes > 2.5 * 1024 * 1024 * 1024
      for: 5m
      labels:
        severity: warning
        component: mini-llm
      annotations:
        summary: "Mini LLM memory usage is high"
        description: "Memory usage has been above 2.5GB for 5 minutes (current: {{ $value | humanize }}B)"
